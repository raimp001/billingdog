{"ast":null,"code":"\"use strict\";\n\n// Copyright (c) 2018-2023 Coinbase, Inc. <https://www.coinbase.com/>\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.WalletLinkSession = void 0;\nconst sha_js_1 = require(\"sha.js\");\nconst util_1 = require(\"../../../../core/type/util\");\nconst STORAGE_KEY_SESSION_ID = 'session:id';\nconst STORAGE_KEY_SESSION_SECRET = 'session:secret';\nconst STORAGE_KEY_SESSION_LINKED = 'session:linked';\nclass WalletLinkSession {\n  constructor(storage, id, secret, linked) {\n    this._storage = storage;\n    this._id = id || (0, util_1.randomBytesHex)(16);\n    this._secret = secret || (0, util_1.randomBytesHex)(32);\n    this._key = new sha_js_1.sha256().update(`${this._id}, ${this._secret} WalletLink`) // ensure old sessions stay connected\n    .digest('hex');\n    this._linked = !!linked;\n  }\n  static load(storage) {\n    const id = storage.getItem(STORAGE_KEY_SESSION_ID);\n    const linked = storage.getItem(STORAGE_KEY_SESSION_LINKED);\n    const secret = storage.getItem(STORAGE_KEY_SESSION_SECRET);\n    if (id && secret) {\n      return new WalletLinkSession(storage, id, secret, linked === '1');\n    }\n    return null;\n  }\n  get id() {\n    return this._id;\n  }\n  get secret() {\n    return this._secret;\n  }\n  get key() {\n    return this._key;\n  }\n  get linked() {\n    return this._linked;\n  }\n  set linked(val) {\n    this._linked = val;\n    this.persistLinked();\n  }\n  save() {\n    this._storage.setItem(STORAGE_KEY_SESSION_ID, this._id);\n    this._storage.setItem(STORAGE_KEY_SESSION_SECRET, this._secret);\n    this.persistLinked();\n    return this;\n  }\n  persistLinked() {\n    this._storage.setItem(STORAGE_KEY_SESSION_LINKED, this._linked ? '1' : '0');\n  }\n}\nexports.WalletLinkSession = WalletLinkSession;","map":{"version":3,"names":["Object","defineProperty","exports","value","WalletLinkSession","sha_js_1","require","util_1","STORAGE_KEY_SESSION_ID","STORAGE_KEY_SESSION_SECRET","STORAGE_KEY_SESSION_LINKED","constructor","storage","id","secret","linked","_storage","_id","randomBytesHex","_secret","_key","sha256","update","digest","_linked","load","getItem","key","val","persistLinked","save","setItem"],"sources":["/Users/shardingdog/billingdog/node_modules/@coinbase/wallet-sdk/dist/sign/walletlink/relay/type/WalletLinkSession.js"],"sourcesContent":["\"use strict\";\n// Copyright (c) 2018-2023 Coinbase, Inc. <https://www.coinbase.com/>\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.WalletLinkSession = void 0;\nconst sha_js_1 = require(\"sha.js\");\nconst util_1 = require(\"../../../../core/type/util\");\nconst STORAGE_KEY_SESSION_ID = 'session:id';\nconst STORAGE_KEY_SESSION_SECRET = 'session:secret';\nconst STORAGE_KEY_SESSION_LINKED = 'session:linked';\nclass WalletLinkSession {\n    constructor(storage, id, secret, linked) {\n        this._storage = storage;\n        this._id = id || (0, util_1.randomBytesHex)(16);\n        this._secret = secret || (0, util_1.randomBytesHex)(32);\n        this._key = new sha_js_1.sha256()\n            .update(`${this._id}, ${this._secret} WalletLink`) // ensure old sessions stay connected\n            .digest('hex');\n        this._linked = !!linked;\n    }\n    static load(storage) {\n        const id = storage.getItem(STORAGE_KEY_SESSION_ID);\n        const linked = storage.getItem(STORAGE_KEY_SESSION_LINKED);\n        const secret = storage.getItem(STORAGE_KEY_SESSION_SECRET);\n        if (id && secret) {\n            return new WalletLinkSession(storage, id, secret, linked === '1');\n        }\n        return null;\n    }\n    get id() {\n        return this._id;\n    }\n    get secret() {\n        return this._secret;\n    }\n    get key() {\n        return this._key;\n    }\n    get linked() {\n        return this._linked;\n    }\n    set linked(val) {\n        this._linked = val;\n        this.persistLinked();\n    }\n    save() {\n        this._storage.setItem(STORAGE_KEY_SESSION_ID, this._id);\n        this._storage.setItem(STORAGE_KEY_SESSION_SECRET, this._secret);\n        this.persistLinked();\n        return this;\n    }\n    persistLinked() {\n        this._storage.setItem(STORAGE_KEY_SESSION_LINKED, this._linked ? '1' : '0');\n    }\n}\nexports.WalletLinkSession = WalletLinkSession;\n"],"mappings":"AAAA,YAAY;;AACZ;AACAA,MAAM,CAACC,cAAc,CAACC,OAAO,EAAE,YAAY,EAAE;EAAEC,KAAK,EAAE;AAAK,CAAC,CAAC;AAC7DD,OAAO,CAACE,iBAAiB,GAAG,KAAK,CAAC;AAClC,MAAMC,QAAQ,GAAGC,OAAO,CAAC,QAAQ,CAAC;AAClC,MAAMC,MAAM,GAAGD,OAAO,CAAC,4BAA4B,CAAC;AACpD,MAAME,sBAAsB,GAAG,YAAY;AAC3C,MAAMC,0BAA0B,GAAG,gBAAgB;AACnD,MAAMC,0BAA0B,GAAG,gBAAgB;AACnD,MAAMN,iBAAiB,CAAC;EACpBO,WAAWA,CAACC,OAAO,EAAEC,EAAE,EAAEC,MAAM,EAAEC,MAAM,EAAE;IACrC,IAAI,CAACC,QAAQ,GAAGJ,OAAO;IACvB,IAAI,CAACK,GAAG,GAAGJ,EAAE,IAAI,CAAC,CAAC,EAAEN,MAAM,CAACW,cAAc,EAAE,EAAE,CAAC;IAC/C,IAAI,CAACC,OAAO,GAAGL,MAAM,IAAI,CAAC,CAAC,EAAEP,MAAM,CAACW,cAAc,EAAE,EAAE,CAAC;IACvD,IAAI,CAACE,IAAI,GAAG,IAAIf,QAAQ,CAACgB,MAAM,CAAC,CAAC,CAC5BC,MAAM,CAAC,GAAG,IAAI,CAACL,GAAG,KAAK,IAAI,CAACE,OAAO,aAAa,CAAC,CAAC;IAAA,CAClDI,MAAM,CAAC,KAAK,CAAC;IAClB,IAAI,CAACC,OAAO,GAAG,CAAC,CAACT,MAAM;EAC3B;EACA,OAAOU,IAAIA,CAACb,OAAO,EAAE;IACjB,MAAMC,EAAE,GAAGD,OAAO,CAACc,OAAO,CAAClB,sBAAsB,CAAC;IAClD,MAAMO,MAAM,GAAGH,OAAO,CAACc,OAAO,CAAChB,0BAA0B,CAAC;IAC1D,MAAMI,MAAM,GAAGF,OAAO,CAACc,OAAO,CAACjB,0BAA0B,CAAC;IAC1D,IAAII,EAAE,IAAIC,MAAM,EAAE;MACd,OAAO,IAAIV,iBAAiB,CAACQ,OAAO,EAAEC,EAAE,EAAEC,MAAM,EAAEC,MAAM,KAAK,GAAG,CAAC;IACrE;IACA,OAAO,IAAI;EACf;EACA,IAAIF,EAAEA,CAAA,EAAG;IACL,OAAO,IAAI,CAACI,GAAG;EACnB;EACA,IAAIH,MAAMA,CAAA,EAAG;IACT,OAAO,IAAI,CAACK,OAAO;EACvB;EACA,IAAIQ,GAAGA,CAAA,EAAG;IACN,OAAO,IAAI,CAACP,IAAI;EACpB;EACA,IAAIL,MAAMA,CAAA,EAAG;IACT,OAAO,IAAI,CAACS,OAAO;EACvB;EACA,IAAIT,MAAMA,CAACa,GAAG,EAAE;IACZ,IAAI,CAACJ,OAAO,GAAGI,GAAG;IAClB,IAAI,CAACC,aAAa,CAAC,CAAC;EACxB;EACAC,IAAIA,CAAA,EAAG;IACH,IAAI,CAACd,QAAQ,CAACe,OAAO,CAACvB,sBAAsB,EAAE,IAAI,CAACS,GAAG,CAAC;IACvD,IAAI,CAACD,QAAQ,CAACe,OAAO,CAACtB,0BAA0B,EAAE,IAAI,CAACU,OAAO,CAAC;IAC/D,IAAI,CAACU,aAAa,CAAC,CAAC;IACpB,OAAO,IAAI;EACf;EACAA,aAAaA,CAAA,EAAG;IACZ,IAAI,CAACb,QAAQ,CAACe,OAAO,CAACrB,0BAA0B,EAAE,IAAI,CAACc,OAAO,GAAG,GAAG,GAAG,GAAG,CAAC;EAC/E;AACJ;AACAtB,OAAO,CAACE,iBAAiB,GAAGA,iBAAiB","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}